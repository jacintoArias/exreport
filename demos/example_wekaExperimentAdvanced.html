<html>

<head>
<style type="text/css">
.knitr .inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
}
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.rimage .left {
  text-align: left;
}
.rimage .right {
  text-align: right;
}
.rimage .center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
<title>Machine Learning Weka Advanced</title>
</head>

<body>

<h3>Introduction</h3>

<p>
In this example we make use of the wekaExperiment dataset that is packaged with
exreport. This dataset represents a series of experiment in which several Machine
Learning classifiers are compared by using a set of public datasets (UCI repository)
as benchmark. The performance measures are the classification accuracy and the
training time and have been obtained from a 10-fold cross-validation.
</p>

<p>
The <i>wekaExperiment</i> contains a variable for the method and dataset and two
# variables for the respective outputs. The datasets contains two parameters, 
# the mentioned fold of the cross-validation for each entry and an additional 
# boolean parameter to indicate if feature selection has been performed or not
# in the execution. 
</p>

<div class="chunk" id="unnamed-chunk-1"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(exreport)</span>
<span class="hl kwd">colnames</span><span class="hl std">(wekaExperiment)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;method&quot;           &quot;problem&quot;          &quot;featureSelection&quot;
## [4] &quot;fold&quot;             &quot;accuracy&quot;         &quot;trainingTime&quot;
</pre></div>
</div></div>


<h3>Initial experimentation</h3>

<p>
In this example we simulate an extension in our experimentation using more
datasets and values for input parameters. In order to do that, we assume that
first we use only 5 datasets, and fold = 0. Also, we do not take into account
the feature selection, so it is not a parameter for us (but its value is "no").
After that, we extend the experimentation using 10 more datasets, ten folds
(from 0 to 9) and two featureSelection  values ("yes" and "no").
Finally, we compare the performace regarding accuracy of the different methods.
</p>

<p>
We use data from the wekaExperiment for the first experimentation and the later
extension. For that, we first need to load the whole experimentation (called 
weka extension) and apply a subset to simulate the first experimentation (weka).
</p>

<div class="chunk" id="unnamed-chunk-2"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">experiment</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">expCreate</span><span class="hl std">(wekaExperiment,</span> <span class="hl kwc">name</span><span class="hl std">=</span><span class="hl str">&quot;weka&quot;</span><span class="hl std">,</span> <span class="hl kwc">parameters</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;fold&quot;</span><span class="hl std">))</span>
<span class="hl std">problems</span>   <span class="hl kwb">&lt;-</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;anneal&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;audiology&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;balance-scale&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;car&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;glass&quot;</span><span class="hl std">)</span>
<span class="hl std">experiment</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">expSubset</span><span class="hl std">(experiment,</span> <span class="hl kwd">list</span><span class="hl std">(</span><span class="hl kwc">problem</span> <span class="hl std">= problems,</span>
                                         <span class="hl kwc">featureSelection</span> <span class="hl std">=</span> <span class="hl str">&quot;no&quot;</span><span class="hl std">,</span>
                                         <span class="hl kwc">fold</span> <span class="hl std">=</span> <span class="hl num">0</span><span class="hl std">) )</span>
</pre></div>
</div></div>

<p>
Even if the subset has been done, the experiment object remember the possible
values for the problem variable. Because of that, if we see the output of
summary(experiment), all the problems are there. However, if we call 
table(experiment$data$problem), we can see only the selected problems are in data
</p>

<div class="chunk" id="unnamed-chunk-3"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">summary</span><span class="hl std">(experiment)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 1 ) Experiment weka loaded from a data set.
## 2 ) A set of pairs 'column:[defaultValues]' has been used to subset the experiment: problem:[anneal, audiology, balance-scale, car, glass], featureSelection:[no], fold:[0]
## 
## #Experiment name: weka
## 
## #method: J48, NaiveBayes, OneR, RandomForest
## 
## #problem: anneal, audiology, balance-scale, car, glass, horsecolic, hypothyroid, ionosphere, liver-disorders, lymph, primary-tumor, soybean, vehicle, vote, vowel
## 
## #parameters:
## *) featureSelection [no,yes]
## *) fold [0,1,2,3,4,5,6,7,8,9]
## 
## #outputs: accuracy, trainingTime
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">table</span><span class="hl std">(experiment</span><span class="hl opt">$</span><span class="hl std">data</span><span class="hl opt">$</span><span class="hl std">problem)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 
##          anneal       audiology   balance-scale             car 
##               4               4               4               4 
##           glass      horsecolic     hypothyroid      ionosphere 
##               4               0               0               0 
## liver-disorders           lymph   primary-tumor         soybean 
##               0               0               0               0 
##         vehicle            vote           vowel 
##               0               0               0
</pre></div>
</div></div>


<p>
It is common that experiment results are in tabular representation (the methods
in rows, the problems in columns and the value in the i-j position represents
the output of the method i for the problem j). In this case, we will use that
representation and load the experiment for that (using the data in experiment).
As we have two outputs (accuracy and trainingTime) we need two tables.
Note that this is only a didactic example, as we already have the experiment
object that we want in the experiment variable.
</p

<div class="chunk" id="unnamed-chunk-4"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">subExp</span>   <span class="hl kwb">&lt;-</span> <span class="hl std">experiment</span><span class="hl opt">$</span><span class="hl std">data[experiment</span><span class="hl opt">$</span><span class="hl std">data</span><span class="hl opt">$</span><span class="hl std">problem</span> <span class="hl opt">%in%</span> <span class="hl std">problems,]</span>
<span class="hl std">accuracy</span> <span class="hl kwb">&lt;-</span> <span class="hl std">reshape2</span><span class="hl opt">::</span><span class="hl kwd">dcast</span><span class="hl std">(subExp[,</span><span class="hl opt">-</span><span class="hl num">4</span><span class="hl std">], method</span> <span class="hl opt">~</span> <span class="hl std">problem,</span> <span class="hl kwc">value.var</span><span class="hl std">=</span><span class="hl str">&quot;accuracy&quot;</span><span class="hl std">)</span>
<span class="hl std">accuracy</span>
</pre></div>
<div class="output"><pre class="knitr r">##         method  anneal audiology balance-scale      car   glass
## 1          J48 97.7778   86.9565       74.6032  74.5665 50.0000
## 2   NaiveBayes 84.4444   82.6087       84.1270  66.4740 40.9091
## 3         OneR 87.7778   47.8261       38.0952 100.0000 50.0000
## 4 RandomForest 96.6667   69.5652       80.9524  79.7688 81.8182
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">time</span> <span class="hl kwb">&lt;-</span> <span class="hl std">reshape2</span><span class="hl opt">::</span><span class="hl kwd">dcast</span><span class="hl std">(subExp[,</span><span class="hl opt">-</span><span class="hl num">3</span><span class="hl std">], method</span> <span class="hl opt">~</span> <span class="hl std">problem,</span> <span class="hl kwc">value.var</span><span class="hl std">=</span><span class="hl str">&quot;trainingTime&quot;</span><span class="hl std">)</span>
<span class="hl std">time</span>
</pre></div>
<div class="output"><pre class="knitr r">##         method anneal audiology balance-scale    car  glass
## 1          J48 0.1360    0.0853        0.0964 0.0700 0.0847
## 2   NaiveBayes 0.0626    0.0411        0.0454 0.0432 0.0393
## 3         OneR 0.0530    0.0358        0.0358 0.0348 0.0332
## 4 RandomForest 0.1404    0.1418        0.1487 0.1557 0.1297
</pre></div>
</div></div>


<p>
At this point we have two tabular data, representing the outputs for 4 methods
and 5 datasets, using the fold value 0 (and no feature selection parameter is
used, although we know its value is "no").
Now, we load two experiments and combine them into a single one.
</p>

<div class="chunk" id="unnamed-chunk-5"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">experimentAcc</span>  <span class="hl kwb">&lt;-</span> <span class="hl kwd">expCreateFromTable</span><span class="hl std">(accuracy,</span> <span class="hl str">&quot;accuracy&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;wekaAccuracy&quot;</span><span class="hl std">,</span>
                                     <span class="hl kwc">parameters</span> <span class="hl std">=</span> <span class="hl kwd">list</span><span class="hl std">(</span><span class="hl kwc">fold</span><span class="hl std">=</span><span class="hl num">0</span><span class="hl std">))</span>
<span class="hl std">experimentTime</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">expCreateFromTable</span><span class="hl std">(time,</span> <span class="hl str">&quot;trainingTime&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;wekaTrainingTime&quot;</span><span class="hl std">,</span>
                                     <span class="hl kwc">parameters</span> <span class="hl std">=</span> <span class="hl kwd">list</span><span class="hl std">(</span><span class="hl kwc">fold</span><span class="hl std">=</span><span class="hl num">0</span><span class="hl std">))</span>
<span class="hl std">experiment</span>     <span class="hl kwb">&lt;-</span> <span class="hl kwd">expCombine</span><span class="hl std">(experimentAcc, experimentTime,</span> <span class="hl kwc">name</span> <span class="hl std">=</span> <span class="hl str">&quot;weka&quot;</span><span class="hl std">)</span>
<span class="hl kwd">summary</span><span class="hl std">(experiment)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 1 ) Description for experiment wekaAccuracy
## 	2 ) Experiment wekaAccuracy loaded from a data set.
## 	3 ) New parameters have been added with default values: fold:0
## 4 ) Description for experiment wekaTrainingTime
## 	5 ) Experiment wekaTrainingTime loaded from a data set.
## 	6 ) New parameters have been added with default values: fold:0
## 7 ) Experiment weka created from combining two experiments: wekaAccuracy and wekaTrainingTime.
## 
## #Experiment name: weka
## 
## #method: J48, NaiveBayes, OneR, RandomForest
## 
## #problem: anneal, audiology, balance-scale, car, glass
## 
## #parameters:
## *) fold [0]
## 
## #outputs: accuracy, trainingTime
</pre></div>
</div></div>


<p>
In this example, we will build the report dynamically. So we create a new report
here at the begining, and we will add each element when it is created.
</p>

<div class="chunk" id="unnamed-chunk-6"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">report</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">exreport</span><span class="hl std">(</span><span class="hl str">&quot;Your wekaExperimentAdvanced example report&quot;</span><span class="hl std">)</span>
<span class="hl com"># We add the experiment to the report</span>
<span class="hl std">report</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">exreportAdd</span><span class="hl std">(report, experiment)</span>
</pre></div>
</div></div>

<h3>Extending the experimentation</h3>

<p>
Now, we want to extend the experimentation using 15 datasets, 10 folds (from 0
to 9) and two values for the parameter featureSelection ("yes" and "no").
However, suppose during the experimentation an error occurred, and for the fold 0 and
the dataset "anneal" the results were not obtained. For that, we want to
combine both experiments into a single one, and remove the duplicated instances.
</p>

<div class="chunk" id="unnamed-chunk-7"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">wekaExperiment2</span>         <span class="hl kwb">&lt;-</span> <span class="hl std">wekaExperiment[wekaExperiment</span><span class="hl opt">$</span><span class="hl std">problem</span><span class="hl opt">!=</span><span class="hl str">&quot;anneal&quot;</span> <span class="hl opt">|</span>
                                            <span class="hl std">wekaExperiment</span><span class="hl opt">$</span><span class="hl std">problem</span><span class="hl opt">!=</span><span class="hl num">0</span><span class="hl std">,]</span>
<span class="hl std">experimentExt</span>           <span class="hl kwb">&lt;-</span> <span class="hl kwd">expCreate</span><span class="hl std">(wekaExperiment2,</span> <span class="hl kwc">name</span><span class="hl std">=</span><span class="hl str">&quot;weka extension&quot;</span><span class="hl std">,</span>
                                     <span class="hl kwc">parameters</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;featureSelection&quot;</span><span class="hl std">,</span><span class="hl str">&quot;fold&quot;</span><span class="hl std">))</span>
</pre></div>
</div></div>

<p>
Right now, the concatenation of the two experiments will rise an error. This
is because experiment has not featureSelection parameter
</p>

<div class="chunk" id="unnamed-chunk-8"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">summary</span><span class="hl std">(experiment)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 1 ) Description for experiment wekaAccuracy
## 	2 ) Experiment wekaAccuracy loaded from a data set.
## 	3 ) New parameters have been added with default values: fold:0
## 4 ) Description for experiment wekaTrainingTime
## 	5 ) Experiment wekaTrainingTime loaded from a data set.
## 	6 ) New parameters have been added with default values: fold:0
## 7 ) Experiment weka created from combining two experiments: wekaAccuracy and wekaTrainingTime.
## 
## #Experiment name: weka
## 
## #method: J48, NaiveBayes, OneR, RandomForest
## 
## #problem: anneal, audiology, balance-scale, car, glass
## 
## #parameters:
## *) fold [0]
## 
## #outputs: accuracy, trainingTime
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">expConcat</span><span class="hl std">(experiment, experimentExt)</span> <span class="hl com"># An error is rised</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in expConcat(experiment, experimentExt): Error: The parameter of the given experiments differ
</pre></div>
</div></div>

<p>
The experiment does not have the featureSelection parameter (we know its value
is "no", but as we did not take into account that variable, it does not
appear). Therefore, we need to extend the experiment adding this variable.
</p>

<div class="chunk" id="unnamed-chunk-9"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">experiment</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">expExtend</span><span class="hl std">(experiment,</span> <span class="hl kwd">list</span><span class="hl std">(</span><span class="hl kwc">featureSelection</span><span class="hl std">=</span><span class="hl str">&quot;no&quot;</span><span class="hl std">))</span>
<span class="hl kwd">summary</span><span class="hl std">(experiment)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 1 ) Description for experiment wekaAccuracy
## 	2 ) Experiment wekaAccuracy loaded from a data set.
## 	3 ) New parameters have been added with default values: fold:0
## 4 ) Description for experiment wekaTrainingTime
## 	5 ) Experiment wekaTrainingTime loaded from a data set.
## 	6 ) New parameters have been added with default values: fold:0
## 7 ) Experiment weka created from combining two experiments: wekaAccuracy and wekaTrainingTime.
## 8 ) New parameters have been added with default values: featureSelection:no
## 
## #Experiment name: weka
## 
## #method: J48, NaiveBayes, OneR, RandomForest
## 
## #problem: anneal, audiology, balance-scale, car, glass
## 
## #parameters:
## *) fold [0]
## *) featureSelection [no]
## 
## #outputs: accuracy, trainingTime
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Now we can concat the two experiments (but there are duplicated instances).</span>
<span class="hl std">experimentExt</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">expConcat</span><span class="hl std">(experiment, experimentExt)</span> <span class="hl com"># A warning is rised</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning in expGetDuplicated(e, tol = tol): 20 duplicated rows. 
##                       0 differ in the outputs (using a tolerance of 1.0000e-09 to compare the outputs)
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Now we can get the duplicated instances. Also, we can remove them.</span>
<span class="hl kwd">head</span><span class="hl std">(</span><span class="hl kwd">expGetDuplicated</span><span class="hl std">(experimentExt)</span><span class="hl opt">$</span><span class="hl std">data)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning in expGetDuplicated(experimentExt): 20 duplicated rows. 
##                       0 differ in the outputs (using a tolerance of 1.0000e-09 to compare the outputs)
</pre></div>
<div class="output"><pre class="knitr r">##        method       problem fold accuracy trainingTime featureSelection
## 9  NaiveBayes           car    0  66.4740       0.0432               no
## 6  NaiveBayes        anneal    0  84.4444       0.0626               no
## 7  NaiveBayes     audiology    0  82.6087       0.0411               no
## 10 NaiveBayes         glass    0  40.9091       0.0393               no
## 8  NaiveBayes balance-scale    0  84.1270       0.0454               no
## 4         J48           car    0  74.5665       0.0700               no
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">experimentExt</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">expRemoveDuplicated</span><span class="hl std">(experimentExt)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning in expRemoveDuplicated(experimentExt): 20 duplicated rows has been
## removed
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># We add the experiment to the report</span>
<span class="hl std">report</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">exreportAdd</span><span class="hl std">(report, experimentExt)</span>
</pre></div>
</div></div>

<h3>Preprocessing data</h3>

<p>
Before proceeding with any kind of analysis we must preprocess our results by
performing the appropiate operations. We will begin by aggregating the result
of the 10-fold cross validation performed for each method and dataset.
For that, we reduce the fold parameter by using the mean function: 
</p>

<div class="chunk" id="unnamed-chunk-10"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">experimentExt</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">expReduce</span><span class="hl std">(experimentExt,</span> <span class="hl str">&quot;fold&quot;</span><span class="hl std">,</span> <span class="hl kwc">FUN</span> <span class="hl std">= mean)</span>
<span class="hl kwd">summary</span><span class="hl std">(experimentExt)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 1 ) Description for experiment weka
## 	2 ) Description for experiment wekaAccuracy
## 		3 ) Experiment wekaAccuracy loaded from a data set.
## 		4 ) New parameters have been added with default values: fold:0
## 	5 ) Description for experiment wekaTrainingTime
## 		6 ) Experiment wekaTrainingTime loaded from a data set.
## 		7 ) New parameters have been added with default values: fold:0
## 	8 ) Experiment weka created from combining two experiments: wekaAccuracy and wekaTrainingTime.
## 	9 ) New parameters have been added with default values: featureSelection:no
## 10 ) Description for experiment weka extension
## 	11 ) Experiment weka extension loaded from a data set.
## 12 ) Experiment weka+weka extension created from appending two experiments: weka and weka extension.
## 13 ) 20 duplicated rows has been removed (using a tolerance of 1.0000e-09 to compare the outputs)
## 14 ) Parameters 'fold' have been removed using the function 'mean'
## 
## #Experiment name: weka+weka extension
## 
## #method: J48, NaiveBayes, OneR, RandomForest
## 
## #problem: anneal, audiology, balance-scale, car, glass, horsecolic, hypothyroid, ionosphere, liver-disorders, lymph, primary-tumor, soybean, vehicle, vote, vowel
## 
## #parameters:
## *) featureSelection [no,yes]
## 
## #outputs: accuracy, trainingTime
</pre></div>
</div></div>

<p>
Now suppose we want to rename some methods. We can do that using expRename.
</p>

<div class="chunk" id="unnamed-chunk-11"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">experimentExt</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">expRename</span><span class="hl std">(experimentExt,</span> <span class="hl kwc">name</span><span class="hl std">=</span><span class="hl str">&quot;weka extension 2&quot;</span><span class="hl std">,</span> <span class="hl kwd">list</span><span class="hl std">(</span><span class="hl kwc">method</span> <span class="hl std">=</span>
                                                                          <span class="hl kwd">list</span><span class="hl std">(</span><span class="hl str">&quot;NaiveBayes&quot;</span><span class="hl std">=</span><span class="hl str">&quot;NBayes&quot;</span><span class="hl std">,</span>
                                                                               <span class="hl str">&quot;RandomForest&quot;</span><span class="hl std">=</span><span class="hl str">&quot;RndFrst&quot;</span><span class="hl std">),</span>
                                                                        <span class="hl kwc">featureSelection</span><span class="hl std">=</span>
                                                                          <span class="hl kwd">list</span><span class="hl std">(</span><span class="hl str">&quot;no&quot;</span><span class="hl std">=</span><span class="hl str">&quot;F&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;yes&quot;</span><span class="hl std">=</span><span class="hl str">&quot;T&quot;</span><span class="hl std">)))</span>
<span class="hl kwd">summary</span><span class="hl std">(experimentExt)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 1 ) Description for experiment weka
## 	2 ) Description for experiment wekaAccuracy
## 		3 ) Experiment wekaAccuracy loaded from a data set.
## 		4 ) New parameters have been added with default values: fold:0
## 	5 ) Description for experiment wekaTrainingTime
## 		6 ) Experiment wekaTrainingTime loaded from a data set.
## 		7 ) New parameters have been added with default values: fold:0
## 	8 ) Experiment weka created from combining two experiments: wekaAccuracy and wekaTrainingTime.
## 	9 ) New parameters have been added with default values: featureSelection:no
## 10 ) Description for experiment weka extension
## 	11 ) Experiment weka extension loaded from a data set.
## 12 ) Experiment weka+weka extension created from appending two experiments: weka and weka extension.
## 13 ) 20 duplicated rows has been removed (using a tolerance of 1.0000e-09 to compare the outputs)
## 14 ) Parameters 'fold' have been removed using the function 'mean'
## 15 ) From experiment renamed to , discrete values from method, problem or parameters columns have been renamed: method: [NaiveBayes-&gt;NBayes, RandomForest-&gt;RndFrst]; featureSelection: [no-&gt;F, yes-&gt;T]
## 
## #Experiment name: weka extension 2
## 
## #method: J48, NBayes, OneR, RndFrst
## 
## #problem: anneal, audiology, balance-scale, car, glass, horsecolic, hypothyroid, ionosphere, liver-disorders, lymph, primary-tumor, soybean, vehicle, vote, vowel
## 
## #parameters:
## *) featureSelection [F,T]
## 
## #outputs: accuracy, trainingTime
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># We add the experiment to the report</span>
<span class="hl std">report</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">exreportAdd</span><span class="hl std">(report, experimentExt)</span>
</pre></div>
</div></div>

<p>
Now that we have a single configuration we instantiate the methods with the
available paramaters. 
</p>

<div class="chunk" id="unnamed-chunk-12"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">experimentExt</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">expInstantiate</span><span class="hl std">(experimentExt)</span>
<span class="hl kwd">summary</span><span class="hl std">(experimentExt)</span> <span class="hl com"># Parameters indicate which are instantiated</span>
</pre></div>
<div class="output"><pre class="knitr r">## 1 ) Description for experiment weka
## 	2 ) Description for experiment wekaAccuracy
## 		3 ) Experiment wekaAccuracy loaded from a data set.
## 		4 ) New parameters have been added with default values: fold:0
## 	5 ) Description for experiment wekaTrainingTime
## 		6 ) Experiment wekaTrainingTime loaded from a data set.
## 		7 ) New parameters have been added with default values: fold:0
## 	8 ) Experiment weka created from combining two experiments: wekaAccuracy and wekaTrainingTime.
## 	9 ) New parameters have been added with default values: featureSelection:no
## 10 ) Description for experiment weka extension
## 	11 ) Experiment weka extension loaded from a data set.
## 12 ) Experiment weka+weka extension created from appending two experiments: weka and weka extension.
## 13 ) 20 duplicated rows has been removed (using a tolerance of 1.0000e-09 to compare the outputs)
## 14 ) Parameters 'fold' have been removed using the function 'mean'
## 15 ) From experiment renamed to , discrete values from method, problem or parameters columns have been renamed: method: [NaiveBayes-&gt;NBayes, RandomForest-&gt;RndFrst]; featureSelection: [no-&gt;F, yes-&gt;T]
## 16 ) Methods has been instanciated with the parameters: featureSelection
## 
## #Experiment name: weka extension 2
## 
## #method: J48,F, NBayes,F, OneR,F, RndFrst,F, J48,T, NBayes,T, OneR,T, RndFrst,T
## 
## #problem: anneal, audiology, balance-scale, car, glass, horsecolic, hypothyroid, ionosphere, liver-disorders, lymph, primary-tumor, soybean, vehicle, vote, vowel
## 
## #parameters:
## *) featureSelection [F,T] (instantiated)
## 
## #outputs: accuracy, trainingTime
</pre></div>
</div></div>

<h3>Visualization</h3>

<p>
We can visualize the experiment
</p>
<div class="chunk" id="unnamed-chunk-13"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">plot</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">plotExpSummary</span><span class="hl std">(experimentExt,</span> <span class="hl str">&quot;accuracy&quot;</span><span class="hl std">,</span> <span class="hl kwc">columns</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">)</span>
<span class="hl std">plot</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-13-1.png" title="plot of chunk unnamed-chunk-13" alt="plot of chunk unnamed-chunk-13" class="plot" /></div><div class="rcode">
<div class="output"><pre class="knitr r">## [1] &quot;Results for output \&quot;accuracy\&quot;&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># We add the plot to the report</span>
<span class="hl std">report</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">exreportAdd</span><span class="hl std">(report, plot)</span>
</pre></div>
</div></div>

<p>
Possibly, we want a different order for the methods or problems.
In this case, we want to compare results for methods when feature selecction
is applied or not, so we want "J48,yes" after "J48,no" and so on.
</p>
<div class="chunk" id="unnamed-chunk-14"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">experimentExt</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">expReorder</span><span class="hl std">(experimentExt,</span> <span class="hl kwd">list</span><span class="hl std">(</span><span class="hl kwc">method</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;J48,F&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;J48,T&quot;</span><span class="hl std">,</span>
                                                         <span class="hl str">&quot;NBayes,F&quot;</span><span class="hl std">,</span><span class="hl str">&quot;NBayes,T&quot;</span><span class="hl std">,</span>
                                                         <span class="hl str">&quot;OneR,F&quot;</span><span class="hl std">,</span><span class="hl str">&quot;OneR,T&quot;</span><span class="hl std">,</span>
                                                         <span class="hl str">&quot;RndFrst,F&quot;</span><span class="hl std">,</span><span class="hl str">&quot;RndFrst,T&quot;</span><span class="hl std">)))</span>
<span class="hl kwd">summary</span><span class="hl std">(experimentExt)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 1 ) Description for experiment weka
## 	2 ) Description for experiment wekaAccuracy
## 		3 ) Experiment wekaAccuracy loaded from a data set.
## 		4 ) New parameters have been added with default values: fold:0
## 	5 ) Description for experiment wekaTrainingTime
## 		6 ) Experiment wekaTrainingTime loaded from a data set.
## 		7 ) New parameters have been added with default values: fold:0
## 	8 ) Experiment weka created from combining two experiments: wekaAccuracy and wekaTrainingTime.
## 	9 ) New parameters have been added with default values: featureSelection:no
## 10 ) Description for experiment weka extension
## 	11 ) Experiment weka extension loaded from a data set.
## 12 ) Experiment weka+weka extension created from appending two experiments: weka and weka extension.
## 13 ) 20 duplicated rows has been removed (using a tolerance of 1.0000e-09 to compare the outputs)
## 14 ) Parameters 'fold' have been removed using the function 'mean'
## 15 ) From experiment renamed to , discrete values from method, problem or parameters columns have been renamed: method: [NaiveBayes-&gt;NBayes, RandomForest-&gt;RndFrst]; featureSelection: [no-&gt;F, yes-&gt;T]
## 16 ) Methods has been instanciated with the parameters: featureSelection
## 17 ) Discrete values from method, problem or parameters columns have been reordered: method: [J48,F, J48,T, NBayes,F, NBayes,T, OneR,F, OneR,T, RndFrst,F, RndFrst,T]
## 
## #Experiment name: weka extension 2
## 
## #method: J48,F, J48,T, NBayes,F, NBayes,T, OneR,F, OneR,T, RndFrst,F, RndFrst,T
## 
## #problem: anneal, audiology, balance-scale, car, glass, horsecolic, hypothyroid, ionosphere, liver-disorders, lymph, primary-tumor, soybean, vehicle, vote, vowel
## 
## #parameters:
## *) featureSelection [F,T] (instantiated)
## 
## #outputs: accuracy, trainingTime
</pre></div>
</div></div>

<p>
If we visualize the experiment again, we have the desired plot
</p>
<div class="chunk" id="unnamed-chunk-15"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">plot</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">plotExpSummary</span><span class="hl std">(experimentExt,</span> <span class="hl str">&quot;accuracy&quot;</span><span class="hl std">,</span> <span class="hl kwc">columns</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">)</span>
<span class="hl std">plot</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-15-1.png" title="plot of chunk unnamed-chunk-15" alt="plot of chunk unnamed-chunk-15" class="plot" /></div><div class="rcode">
<div class="output"><pre class="knitr r">## [1] &quot;Results for output \&quot;accuracy\&quot;&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># We add the plot to the report</span>
<span class="hl std">report</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">exreportAdd</span><span class="hl std">(report, plot)</span>
</pre></div>
</div></div>

<h3>Validation</h3>
<p>
Our experiment is now ready to be validated by using statistical tests. In this
case we have more than two methods, so we will choose a multiple comparison test.
We want to compare all pairs of methods, for that we will perform a
"testMultiplePairwise" test, including a Friedman test followed by a post-hoc
test using the Holm procedure. As the target variable is the accuracy,
the test will measure maximization.
</p>

<div class="chunk" id="unnamed-chunk-16"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">testAccuracyPairwise</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">testMultiplePairwise</span><span class="hl std">(experimentExt,</span><span class="hl str">&quot;accuracy&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;max&quot;</span><span class="hl std">)</span>
<span class="hl kwd">summary</span><span class="hl std">(testAccuracyPairwise)</span>
</pre></div>
<div class="output"><pre class="knitr r">## ---------------------------------------------------------------------
## Friedman test, objetive maximize output variable accuracy. Obtained p-value: 4.1679e-08
## Chi squared with 7 degrees of freedom statistic: 47.6500
## Test rejected: p-value: 4.1679e-08 &lt; 0.0500
## ---------------------------------------------------------------------
## Pairwise post hoc test for output accuracy
## Adjust method: Shaffer
## 
## p-values:
##           J48,F RndFrst,T     J48,T   NBayes,F   NBayes,T       OneR,F
## RndFrst,F     1         1 0.4309044 0.06025137 0.01395224 4.125442e-05
## J48,F        NA         1 1.0000000 0.45981358 0.17266188 1.668243e-03
## RndFrst,T    NA        NA 1.0000000 1.00000000 0.61839883 1.529973e-02
## J48,T        NA        NA        NA 1.00000000 1.00000000 1.822777e-01
## NBayes,F     NA        NA        NA         NA 1.00000000 8.818142e-01
## NBayes,T     NA        NA        NA         NA         NA 1.000000e+00
## OneR,F       NA        NA        NA         NA         NA           NA
##                 OneR,T
## RndFrst,F 6.205344e-06
## J48,F     3.376488e-04
## RndFrst,T 4.012438e-03
## J48,T     6.476731e-02
## NBayes,F  4.462741e-01
## NBayes,T  9.581391e-01
## OneR,F    1.000000e+00
## ---------------------------------------------------------------------
</pre></div>
</div></div>

<p>
Now we generate a tabular summary for the pairwise test. 
</p>

<div class="chunk" id="unnamed-chunk-17"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">table</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">tabularTestPairwise</span><span class="hl std">(testAccuracyPairwise,</span> <span class="hl str">&quot;pvalue&quot;</span><span class="hl std">)</span>
<span class="hl std">table</span>
</pre></div>
<div class="output"><pre class="knitr r">## $testPairwise
##      method J48,F RndFrst,T     J48,T   NBayes,F   NBayes,T       OneR,F
## 1 RndFrst,F     1         1 0.4309044 0.06025137 0.01395224 4.125442e-05
## 2     J48,F    NA         1 1.0000000 0.45981358 0.17266188 1.668243e-03
## 3 RndFrst,T    NA        NA 1.0000000 1.00000000 0.61839883 1.529973e-02
## 4     J48,T    NA        NA        NA 1.00000000 1.00000000 1.822777e-01
## 5  NBayes,F    NA        NA        NA         NA 1.00000000 8.818142e-01
## 6  NBayes,T    NA        NA        NA         NA         NA 1.000000e+00
## 7    OneR,F    NA        NA        NA         NA         NA           NA
##         OneR,T
## 1 6.205344e-06
## 2 3.376488e-04
## 3 4.012438e-03
## 4 6.476731e-02
## 5 4.462741e-01
## 6 9.581391e-01
## 7 1.000000e+00
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># We add the table to the report</span>
<span class="hl std">report</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">exreportAdd</span><span class="hl std">(report, table)</span>
</pre></div>
</div></div>

<p>
We also want to make a double test pipeline. First, we want to obtain a ranking
among the methods and decide which one is the best one, based on accuracy.
After that, for all those methods which are not statistically different from
the best one, we will perform a second test (again, based in rankings) but in
this case based on training time (therefore the test will measure minimization).
The alpha value used in this case is 0.32. This value has been chosen just for
didactic reasons, in order to get only one method not statistically different
from the best one.
</p>

<div class="chunk" id="unnamed-chunk-18"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">testAccuracy</span>    <span class="hl kwb">&lt;-</span> <span class="hl kwd">testMultipleControl</span><span class="hl std">(experimentExt,</span> <span class="hl str">&quot;accuracy&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;max&quot;</span><span class="hl std">,</span> <span class="hl kwc">alpha</span> <span class="hl std">=</span> <span class="hl num">0.32</span><span class="hl std">)</span>
<span class="hl kwd">summary</span><span class="hl std">(testAccuracy)</span>
</pre></div>
<div class="output"><pre class="knitr r">## ---------------------------------------------------------------------
## Friedman test, objetive maximize output variable accuracy. Obtained p-value: 4.1679e-08
## Chi squared with 7 degrees of freedom statistic: 47.6500
## Test rejected: p-value: 4.1679e-08 &lt; 0.3200
## ---------------------------------------------------------------------
## Control post hoc test for output accuracy
## Adjust method: Holm
## 
## Control method: RndFrst,F
## p-values:
##           J48,F	0.4123
##       RndFrst,T	0.3134
##           J48,T	0.0760
##        NBayes,F	0.0115
##        NBayes,T	0.0030
##          OneR,F	0.0000
##          OneR,T	0.0000
## ---------------------------------------------------------------------
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># We add the test to the report</span>
<span class="hl std">report</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">exreportAdd</span><span class="hl std">(report, testAccuracy)</span>

<span class="hl com"># Now we generate a tabular summary for the pairwise test. </span>
<span class="hl std">table</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">tabularTestSummary</span><span class="hl std">(testAccuracy,</span> <span class="hl str">&quot;pvalue&quot;</span><span class="hl std">)</span>
<span class="hl std">table</span>
</pre></div>
<div class="output"><pre class="knitr r">## $testMultiple
##      method       pvalue
## 7 RndFrst,F           NA
## 1     J48,F 4.122779e-01
## 8 RndFrst,T 3.134477e-01
## 2     J48,T 7.604196e-02
## 3  NBayes,F 1.147645e-02
## 4  NBayes,T 3.033095e-03
## 5    OneR,F 9.167649e-06
## 6    OneR,T 1.551336e-06
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># We add the table to the report</span>
<span class="hl std">report</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">exreportAdd</span><span class="hl std">(report, table)</span>

<span class="hl com"># Here we extract the instances from the methods which are not statistically</span>
<span class="hl com"># differente from the best one</span>
<span class="hl std">experimentExt2</span>  <span class="hl kwb">&lt;-</span><span class="hl kwd">expExtract</span><span class="hl std">(testAccuracy)</span>
<span class="hl kwd">summary</span><span class="hl std">(experimentExt2)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 1 ) Description for experiment weka
## 	2 ) Description for experiment wekaAccuracy
## 		3 ) Experiment wekaAccuracy loaded from a data set.
## 		4 ) New parameters have been added with default values: fold:0
## 	5 ) Description for experiment wekaTrainingTime
## 		6 ) Experiment wekaTrainingTime loaded from a data set.
## 		7 ) New parameters have been added with default values: fold:0
## 	8 ) Experiment weka created from combining two experiments: wekaAccuracy and wekaTrainingTime.
## 	9 ) New parameters have been added with default values: featureSelection:no
## 10 ) Description for experiment weka extension
## 	11 ) Experiment weka extension loaded from a data set.
## 12 ) Experiment weka+weka extension created from appending two experiments: weka and weka extension.
## 13 ) 20 duplicated rows has been removed (using a tolerance of 1.0000e-09 to compare the outputs)
## 14 ) Parameters 'fold' have been removed using the function 'mean'
## 15 ) From experiment renamed to , discrete values from method, problem or parameters columns have been renamed: method: [NaiveBayes-&gt;NBayes, RandomForest-&gt;RndFrst]; featureSelection: [no-&gt;F, yes-&gt;T]
## 16 ) Methods has been instanciated with the parameters: featureSelection
## 17 ) Discrete values from method, problem or parameters columns have been reordered: method: [J48,F, J48,T, NBayes,F, NBayes,T, OneR,F, OneR,T, RndFrst,F, RndFrst,T]
## 18 ) Subset of experiment based on the results of the Control post-hoc test with Holm p-value adjustment for output accuracy
## 
## #Experiment name: weka extension 2
## 
## #method: J48,F, J48,T, NBayes,F, NBayes,T, OneR,F, OneR,T, RndFrst,F, RndFrst,T
## 
## #problem: anneal, audiology, balance-scale, car, glass, horsecolic, hypothyroid, ionosphere, liver-disorders, lymph, primary-tumor, soybean, vehicle, vote, vowel
## 
## #parameters:
## *) featureSelection [F,T] (instantiated)
## 
## #outputs: accuracy, trainingTime
</pre></div>
</div></div>

<p>
Now we want to apply a second level test based on training time. In this case,
the previous function testMultipleControl will arise an error as only two
methods passed the test (in that case, a paired test is needed).
</p>

<div class="chunk" id="unnamed-chunk-19"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">testTime</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">testMultipleControl</span><span class="hl std">(experimentExt2,</span> <span class="hl str">&quot;trainingTime&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;min&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in .doFriedmanTest(e, output, rankOrder, alpha): Error: Only two methods available for Friedman Test, please perform Wilcoxon Test instead
</pre></div>
</div></div>

<p>
We use a paired test in order to make de comparison.
</p>

<div class="chunk" id="unnamed-chunk-20"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">testTime</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">testPaired</span><span class="hl std">(experimentExt2,</span> <span class="hl str">&quot;trainingTime&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;min&quot;</span><span class="hl std">)</span>
<span class="hl kwd">summary</span><span class="hl std">(testTime)</span>
</pre></div>
<div class="output"><pre class="knitr r">##             Length Class    Mode     
## bestMethod  1      -none-   character
## worstMethod 1      -none-   character
## tags        8      metaTags list
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># We add the test to the report</span>
<span class="hl std">report</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">exreportAdd</span><span class="hl std">(report, testTime)</span>
</pre></div>
</div></div>

<h3>Communication</h3>
<p>
Now the report has been built. Now we render it to visualize.
</p>

<div class="chunk" id="unnamed-chunk-21"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com"># Render the report in HTML format:</span>
<span class="hl kwd">exreportRender</span><span class="hl std">(report,</span> <span class="hl kwc">target</span> <span class="hl std">=</span> <span class="hl str">&quot;html&quot;</span><span class="hl std">,</span> <span class="hl kwc">visualize</span> <span class="hl std">= T)</span>
<span class="hl com"># Render the report in pdf format:</span>
<span class="hl kwd">exreportRender</span><span class="hl std">(report,</span> <span class="hl kwc">target</span> <span class="hl std">=</span> <span class="hl str">&quot;pdf&quot;</span><span class="hl std">,</span> <span class="hl kwc">visualize</span> <span class="hl std">= T)</span>
</pre></div>
</div></div>

</body>
</html>
